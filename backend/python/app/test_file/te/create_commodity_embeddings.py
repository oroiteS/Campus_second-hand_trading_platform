import chromadb
import numpy as np
all_data = [
    ["d0b7acff-4b83-11f0-8855-9c2dcd12e445", 1, [10, 91], "U10000001"],
    ["d0b82c2a-4b83-11f0-8855-9c2dcd12e445", 1, [14, 95], "U10000001"],
    ["d0b82ef2-4b83-11f0-8855-9c2dcd12e445", 1, [13, 56, 92], "U10000001"],
    ["d0b83191-4b83-11f0-8855-9c2dcd12e445", 1, [46, 54, 90], "U10000001"],
    ["d0b8335f-4b83-11f0-8855-9c2dcd12e445", 1, [30, 95], "U10000001"],
    ["d0b83519-4b83-11f0-8855-9c2dcd12e445", 1, [9, 91], "U10000001"],
    ["d0b83697-4b83-11f0-8855-9c2dcd12e445", 1, [40, 7, 90], "U10000001"],
    ["d0b83836-4b83-11f0-8855-9c2dcd12e445", 1, [24, 55, 91], "U10000001"],
    ["d0b83a6c-4b83-11f0-8855-9c2dcd12e445", 1, [33, 59, 95], "U10000001"],
    ["d0b83bdb-4b83-11f0-8855-9c2dcd12e445", 1, [11, 92], "U10000001"],
    ["d0b83d60-4b83-11f0-8855-9c2dcd12e445", 1, [48, 54, 90], "U10000001"],
    ["d0b83ed1-4b83-11f0-8855-9c2dcd12e445", 1, [18, 90], "U10000001"],
    ["d0b84035-4b83-11f0-8855-9c2dcd12e445", 1, [21, 56, 91], "U10000001"],
    ["d0b841a0-4b83-11f0-8855-9c2dcd12e445", 1, [97, 95], "U10000001"],
    ["d0b84323-4b83-11f0-8855-9c2dcd12e445", 1, [38, 92], "U10000001"],
    ["d0b844a4-4b83-11f0-8855-9c2dcd12e445", 1, [50, 54, 91], "U10000001"],
    ["d0b84601-4b83-11f0-8855-9c2dcd12e445", 1, [15, 90], "U10000001"],
    ["d0b84768-4b83-11f0-8855-9c2dcd12e445", 1, [62, 56, 91], "U10000001"],
    ["d0b84b10-4b83-11f0-8855-9c2dcd12e445", 1, [52, 54, 90], "U10000001"],
    ["d0b84e17-4b83-11f0-8855-9c2dcd12e445", 1, [43, 95], "U10000001"],
    ["d0ba4130-4b83-11f0-8855-9c2dcd12e445", 2, [117, 136, 95], "U10000001"],
    ["d0ba46ac-4b83-11f0-8855-9c2dcd12e445", 2, [129, 137, 91], "U10000001"],
    ["d0ba6018-4b83-11f0-8855-9c2dcd12e445", 2, [145, 92], "U10000001"],
    ["d0ba61d2-4b83-11f0-8855-9c2dcd12e445", 2, [121, 139, 90], "U10000001"],
    ["d0ba6394-4b83-11f0-8855-9c2dcd12e445", 2, [112, 142, 150, 91], "U10000001"],
    ["d0ba659e-4b83-11f0-8855-9c2dcd12e445", 2, [111, 144, 92], "U10000001"],
    ["d0ba6748-4b83-11f0-8855-9c2dcd12e445", 2, [120, 131, 137, 91], "U10000001"],
    ["d0ba68bb-4b83-11f0-8855-9c2dcd12e445", 2, [153, 90], "U10000001"],
    ["d0ba6a35-4b83-11f0-8855-9c2dcd12e445", 2, [105, 93], "U10000001"],
    ["d0ba6b88-4b83-11f0-8855-9c2dcd12e445", 2, [130, 145, 92], "U10000001"],
    ["d0ba6d0a-4b83-11f0-8855-9c2dcd12e445", 2, [112, 144, 95], "U10000001"],
    ["d0ba6e62-4b83-11f0-8855-9c2dcd12e445", 2, [113, 147, 91], "U10000001"],
    ["d0ba6fcc-4b83-11f0-8855-9c2dcd12e445", 2, [112, 141, 92], "U10000001"],
    ["d0ba7134-4b83-11f0-8855-9c2dcd12e445", 2, [115, 148, 90], "U10000001"],
    ["d0ba72c3-4b83-11f0-8855-9c2dcd12e445", 2, [112, 142, 91], "U10000001"],
    ["d0ba741e-4b83-11f0-8855-9c2dcd12e445", 2, [154, 92], "U10000001"],
    ["d0ba75a0-4b83-11f0-8855-9c2dcd12e445", 2, [147, 91], "U10000001"],
    ["d0ba76f5-4b83-11f0-8855-9c2dcd12e445", 2, [115, 92], "U10000001"],
    ["d0ba786c-4b83-11f0-8855-9c2dcd12e445", 2, [130, 145, 90], "U10000001"],
    ["d0ba79c6-4b83-11f0-8855-9c2dcd12e445", 2, [147, 91], "U10000001"],
    ["d0bcdc19-4b83-11f0-8855-9c2dcd12e445", 3, [173, 180], "U10000001"],
    ["d0bce1b6-4b83-11f0-8855-9c2dcd12e445", 3, [174], "U10000001"],
    ["d0bce36e-4b83-11f0-8855-9c2dcd12e445", 3, [175, 233], "U10000001"],
    ["d0bce4f5-4b83-11f0-8855-9c2dcd12e445", 3, [239], "U10000001"],
    ["d0bce688-4b83-11f0-8855-9c2dcd12e445", 3, [160], "U10000001"],
    ["d0bce7f2-4b83-11f0-8855-9c2dcd12e445", 3, [172], "U10000001"],
    ["d0bce946-4b83-11f0-8855-9c2dcd12e445", 3, [178], "U10000001"],
    ["d0bcea9f-4b83-11f0-8855-9c2dcd12e445", 3, [186], "U10000001"],
    ["d0bcebf7-4b83-11f0-8855-9c2dcd12e445", 3, [165], "U10000001"],
    ["d0bced5f-4b83-11f0-8855-9c2dcd12e445", 3, [157], "U10000001"],
    ["d0bceeb6-4b83-11f0-8855-9c2dcd12e445", 3, [182], "U10000001"],
    ["d0bcf00c-4b83-11f0-8855-9c2dcd12e445", 3, [177], "U10000001"],
    ["d0bcf15c-4b83-11f0-8855-9c2dcd12e445", 3, [162], "U10000001"],
    ["d0bcf2d3-4b83-11f0-8855-9c2dcd12e445", 3, [179, 200], "U10000001"],
    ["d0bcf42a-4b83-11f0-8855-9c2dcd12e445", 3, [169], "U10000001"],
    ["d0bcf581-4b83-11f0-8855-9c2dcd12e445", 3, [173], "U10000001"],
    ["d0bcf6d8-4b83-11f0-8855-9c2dcd12e445", 3, [167, 197], "U10000001"],
    ["d0bcf84d-4b83-11f0-8855-9c2dcd12e445", 3, [185], "U10000001"],
    ["d0bcf9a1-4b83-11f0-8855-9c2dcd12e445", 3, [180], "U10000001"],
    ["d0bcfaf4-4b83-11f0-8855-9c2dcd12e445", 3, [153], "U10000001"],
    ["d0bebc67-4b83-11f0-8855-9c2dcd12e445", 4, [259, 261], "U10000001"],
    ["d0bec208-4b83-11f0-8855-9c2dcd12e445", 4, [267, 307], "U10000001"],
    ["d0bec3bc-4b83-11f0-8855-9c2dcd12e445", 4, [257, 263], "U10000001"],
    ["d0bec54d-4b83-11f0-8855-9c2dcd12e445", 4, [268], "U10000001"],
    ["d0bec6c7-4b83-11f0-8855-9c2dcd12e445", 4, [261, 262], "U10000001"],
    ["d0bec867-4b83-11f0-8855-9c2dcd12e445", 4, [278], "U10000001"],
    ["d0beca0b-4b83-11f0-8855-9c2dcd12e445", 4, [265], "U10000001"],
    ["d0bfd744-4b83-11f0-8855-9c2dcd12e445", 4, [274, 209], "U10000001"],
    ["d0bfda2d-4b83-11f0-8855-9c2dcd12e445", 4, [273], "U10000001"],
    ["d0bfdbbd-4b83-11f0-8855-9c2dcd12e445", 4, [279], "U10000001"],
    ["d0bfdd60-4b83-11f0-8855-9c2dcd12e445", 4, [283], "U10000001"],
    ["d0bfdf00-4b83-11f0-8855-9c2dcd12e445", 4, [269], "U10000001"],
    ["d0bfe069-4b83-11f0-8855-9c2dcd12e445", 4, [276, 210], "U10000001"],
    ["d0bfe1d4-4b83-11f0-8855-9c2dcd12e445", 4, [280], "U10000001"],
    ["d0bfe34b-4b83-11f0-8855-9c2dcd12e445", 4, [270], "U10000001"],
    ["d0bfe4bd-4b83-11f0-8855-9c2dcd12e445", 4, [277], "U10000001"],
    ["d0bfe63c-4b83-11f0-8855-9c2dcd12e445", 4, [303], "U10000001"],
    ["d0bfe7b6-4b83-11f0-8855-9c2dcd12e445", 4, [293], "U10000001"],
    ["d0bfe932-4b83-11f0-8855-9c2dcd12e445", 4, [299], "U10000001"],
    ["d0bfeaa8-4b83-11f0-8855-9c2dcd12e445", 4, [284], "U10000001"],
    ["d0c1a780-4b83-11f0-8855-9c2dcd12e445", 5, [309, 344], "U10000001"],
    ["d0c1aede-4b83-11f0-8855-9c2dcd12e445", 5, [310, 366], "U10000001"],
    ["d0c1b0f6-4b83-11f0-8855-9c2dcd12e445", 5, [347], "U10000001"],
    ["d0c1b2c2-4b83-11f0-8855-9c2dcd12e445", 5, [315, 356], "U10000001"],
    ["d0c1b447-4b83-11f0-8855-9c2dcd12e445", 5, [325, 363], "U10000001"],
    ["d0c1b5dd-4b83-11f0-8855-9c2dcd12e445", 5, [380], "U10000001"],
    ["d0c1b75a-4b83-11f0-8855-9c2dcd12e445", 5, [330, 362], "U10000001"],
    ["d0c1b8e9-4b83-11f0-8855-9c2dcd12e445", 5, [329, 364], "U10000001"],
    ["d0c1ba4b-4b83-11f0-8855-9c2dcd12e445", 5, [336, 365], "U10000001"],
    ["d0c1bba6-4b83-11f0-8855-9c2dcd12e445", 5, [351], "U10000001"],
    ["d0c1bd1b-4b83-11f0-8855-9c2dcd12e445", 5, [320, 344], "U10000001"],
    ["d0c1be83-4b83-11f0-8855-9c2dcd12e445", 5, [316, 356], "U10000001"],
    ["d0c1bfd8-4b83-11f0-8855-9c2dcd12e445", 5, [396], "U10000001"],
    ["d0c1c144-4b83-11f0-8855-9c2dcd12e445", 5, [319, 349], "U10000001"],
    ["d0c1c2a2-4b83-11f0-8855-9c2dcd12e445", 5, [395], "U10000001"],
    ["d0c1c412-4b83-11f0-8855-9c2dcd12e445", 5, [321, 344], "U10000001"],
    ["d0c1c56a-4b83-11f0-8855-9c2dcd12e445", 5, [353, 377], "U10000001"],
    ["d0c1c6b9-4b83-11f0-8855-9c2dcd12e445", 5, [310, 387], "U10000001"],
    ["d0c1c806-4b83-11f0-8855-9c2dcd12e445", 5, [361], "U10000001"],
    ["d0c1c99a-4b83-11f0-8855-9c2dcd12e445", 5, [391], "U10000001"],
    ["d0c36488-4b83-11f0-8855-9c2dcd12e445", 6, [401, 417, 433], "U10000001"],
    ["d0c36a40-4b83-11f0-8855-9c2dcd12e445", 6, [402, 419, 431, 466], "U10000001"],
    ["d0c36c43-4b83-11f0-8855-9c2dcd12e445", 6, [403, 421, 434, 465], "U10000001"],
    ["d0c36dd2-4b83-11f0-8855-9c2dcd12e445", 6, [409, 427], "U10000001"],
    ["d0c4000d-4b83-11f0-8855-9c2dcd12e445", 6, [410], "U10000001"],
    ["d0c402a4-4b83-11f0-8855-9c2dcd12e445", 6, [414, 418, 436, 464], "U10000001"],
    ["d0c40459-4b83-11f0-8855-9c2dcd12e445", 6, [404, 417, 436], "U10000001"],
    ["d0c405e6-4b83-11f0-8855-9c2dcd12e445", 6, [418, 431, 464], "U10000001"],
    ["d0c40764-4b83-11f0-8855-9c2dcd12e445", 6, [424], "U10000001"],
    ["d0c408cb-4b83-11f0-8855-9c2dcd12e445", 6, [428], "U10000001"],
    ["d0c40a46-4b83-11f0-8855-9c2dcd12e445", 6, [406, 418, 437], "U10000001"],
    ["d0c40bd0-4b83-11f0-8855-9c2dcd12e445", 6, [411, 427], "U10000001"],
    ["d0c40d38-4b83-11f0-8855-9c2dcd12e445", 6, [422, 433], "U10000001"],
    ["d0c40e8f-4b83-11f0-8855-9c2dcd12e445", 6, [430, 440, 464], "U10000001"],
    ["d0c40ffc-4b83-11f0-8855-9c2dcd12e445", 6, [408, 419, 434, 465], "U10000001"],
    ["d0c41175-4b83-11f0-8855-9c2dcd12e445", 6, [429], "U10000001"],
    ["d0c412dd-4b83-11f0-8855-9c2dcd12e445", 6, [407, 418, 431, 466], "U10000001"],
    ["d0c41439-4b83-11f0-8855-9c2dcd12e445", 6, [425, 446], "U10000001"],
    ["d0c415a6-4b83-11f0-8855-9c2dcd12e445", 6, [422, 431], "U10000001"],
    ["d0c41718-4b83-11f0-8855-9c2dcd12e445", 6, [427], "U10000001"]
]

client = chromadb.PersistentClient('./embedding_folder')
collection_commodity = client.get_or_create_collection('commodities')
collection_tag = client.get_or_create_collection('tags')
collection_category = client.get_or_create_collection('categories')
for data in all_data:
    tag_embedding = np.zeros(2560)
    print(f"category_{data[1]}")
    category_results = collection_category.get(
        ids=[f"category_{data[1]}"],
        include=['embeddings']
    )
    category_embedding = np.array(category_results['embeddings'][0])
    for tid in data[2]:
        tag_embedding += np.array(collection_tag.get(
            where={"tag_id": tid},
            include=['embeddings']
        )['embeddings'][0])
    embedding_sum = category_embedding + tag_embedding
    embedding_sum = embedding_sum.tolist()
    collection_commodity.upsert(
        ids = [data[0]],
        embeddings = [embedding_sum],
        metadatas = [
            {
                'seller_id':data[3],
            }
        ]
    )
